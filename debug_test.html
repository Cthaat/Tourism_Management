<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>小程序主题切换调试</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
      transition: all 0.3s ease;
    }

    body.dark-mode {
      background: #1a1a1a;
      color: #ffffff;
    }

    .container {
      max-width: 400px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .dark-mode .container {
      background: #2a2a2a;
      color: #ffffff;
    }

    .debug-section {
      padding: 15px;
      background: rgba(255, 0, 0, 0.1);
      margin: 15px 0;
      border-radius: 8px;
      border: 1px solid rgba(255, 0, 0, 0.2);
    }

    .debug-info {
      margin: 10px 0;
      font-weight: bold;
    }

    button {
      padding: 8px 16px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    .btn-primary {
      background: #007aff;
      color: white;
    }

    .btn-default {
      background: #f0f0f0;
      color: #333;
    }

    .dark-mode .btn-default {
      background: #444;
      color: #fff;
    }

    .showcase-header {
      text-align: center;
      padding: 30px 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 10px;
      margin: 20px 0;
    }

    .page-title {
      font-size: 24px;
      font-weight: bold;
      display: block;
      margin-bottom: 8px;
    }

    .page-subtitle {
      font-size: 14px;
      opacity: 0.9;
    }

    .log-section {
      background: #f8f8f8;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
    }

    .dark-mode .log-section {
      background: #333;
      color: #0f0;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Showcase页面主题切换调试</h1>

    <!-- 调试区域 -->
    <div class="debug-section">
      <div class="debug-info">调试信息:</div>
      <div class="debug-info">isDarkMode: <span id="isDarkMode">false</span></div>
      <div class="debug-info">colorTheme: <span id="colorTheme">default</span></div>
      <button class="btn-primary" onclick="testToggleDarkMode()">切换深色模式</button>
      <button class="btn-default" onclick="testToggleTheme()">切换主题色</button>
    </div>

    <!-- 模拟showcase页面头部 -->
    <div class="showcase-header">
      <span class="page-title">功能展示</span>
      <span class="page-subtitle">探索旅游管理小程序的强大功能</span>
    </div>

    <!-- 日志区域 -->
    <div class="log-section" id="logSection">
      <div>===== 调试日志 =====</div>
    </div>

    <button onclick="clearLogs()" class="btn-default">清空日志</button>
  </div>

  <script>
    // 模拟小程序环境
    let globalData = {
      darkMode: false,
      colorTheme: 'default'
    };

    let pageData = {
      isDarkMode: false,
      colorTheme: 'default'
    };

    let themeChangeCallbacks = [];

    // 模拟app对象
    const app = {
      globalData: globalData,

      watchThemeChange(callback) {
        themeChangeCallbacks.push(callback);
        log('注册主题变化监听器');
      },

      toggleDarkMode() {
        log('=== 调用toggleDarkMode ===');
        log('切换前全局状态: ' + globalData.darkMode);

        globalData.darkMode = !globalData.darkMode;

        log('切换后全局状态: ' + globalData.darkMode);

        // 触发所有回调
        themeChangeCallbacks.forEach(callback => {
          log('触发主题变化回调: ' + callback.name);
          callback(globalData.darkMode, globalData.colorTheme);
        });

        return globalData.darkMode;
      },

      changeColorTheme(newTheme) {
        log('=== 调用changeColorTheme ===');
        log('切换前主题: ' + globalData.colorTheme);
        log('切换到主题: ' + newTheme);

        globalData.colorTheme = newTheme;

        // 触发所有回调
        themeChangeCallbacks.forEach(callback => {
          callback(globalData.darkMode, globalData.colorTheme);
        });
      }
    };

    // 日志函数
    function log(message) {
      const logSection = document.getElementById('logSection');
      const time = new Date().toLocaleTimeString();
      logSection.innerHTML += `<div>[${time}] ${message}</div>`;
      logSection.scrollTop = logSection.scrollHeight;
      console.log(message);
    }

    // 更新页面数据显示
    function updatePageData() {
      document.getElementById('isDarkMode').textContent = pageData.isDarkMode;
      document.getElementById('colorTheme').textContent = pageData.colorTheme;

      // 应用样式
      if (pageData.isDarkMode) {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
    }

    // 模拟页面的setData方法
    function setData(data) {
      log('调用setData: ' + JSON.stringify(data));
      if (data.isDarkMode !== undefined) {
        pageData.isDarkMode = data.isDarkMode;
      }
      if (data.colorTheme !== undefined) {
        pageData.colorTheme = data.colorTheme;
      }
      updatePageData();
    }

    // 模拟showcase页面的onLoad方法
    function onLoad() {
      log('=== Showcase页面onLoad调试 ===');
      log('全局数据 app.globalData: ' + JSON.stringify(globalData));
      log('当前深色模式状态: ' + globalData.darkMode);
      log('当前主题色: ' + globalData.colorTheme);

      // 监听主题变化
      app.watchThemeChange((darkMode, colorTheme) => {
        log('Showcase页面 - 主题变化回调: ' + JSON.stringify({ darkMode, colorTheme }));
        setData({
          isDarkMode: darkMode,
          colorTheme: colorTheme
        });
      });

      // 初始化主题状态
      setData({
        isDarkMode: globalData.darkMode,
        colorTheme: globalData.colorTheme
      });

      log('Showcase页面初始化后 data: ' + JSON.stringify({
        isDarkMode: pageData.isDarkMode,
        colorTheme: pageData.colorTheme
      }));
    }

    // 测试深色模式切换
    function testToggleDarkMode() {
      log('=== 测试深色模式切换 ===');
      log('切换前: 全局=' + globalData.darkMode + ', 页面=' + pageData.isDarkMode);

      // 调用全局切换方法
      const newDarkMode = app.toggleDarkMode();

      log('调用toggleDarkMode后全局状态: ' + globalData.darkMode);

      // 手动同步状态（模拟小程序中的setTimeout）
      setTimeout(() => {
        setData({
          isDarkMode: globalData.darkMode,
          colorTheme: globalData.colorTheme
        });
        log('切换后: 全局=' + globalData.darkMode + ', 页面=' + pageData.isDarkMode);
      }, 100);
    }

    // 测试主题色切换
    function testToggleTheme() {
      log('=== 测试主题色切换 ===');
      const themes = ['default', 'blue', 'red'];
      const currentIndex = themes.indexOf(pageData.colorTheme);
      const nextIndex = (currentIndex + 1) % themes.length;
      const nextTheme = themes[nextIndex];

      log('切换前主题: ' + pageData.colorTheme);
      log('即将切换到: ' + nextTheme);

      // 调用全局主题切换方法
      app.changeColorTheme(nextTheme);

      // 手动同步状态
      setTimeout(() => {
        setData({
          isDarkMode: globalData.darkMode,
          colorTheme: globalData.colorTheme
        });
        log('切换后主题: ' + pageData.colorTheme);
      }, 100);
    }

    // 清空日志
    function clearLogs() {
      document.getElementById('logSection').innerHTML = '<div>===== 调试日志 =====</div>';
    }

    // 页面加载时执行onLoad
    window.onload = function () {
      onLoad();
    };
  </script>
</body>

</html>