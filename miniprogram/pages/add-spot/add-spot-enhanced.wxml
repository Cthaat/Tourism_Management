<!-- add-spoté¡µé¢å¢å¼ºç‰ˆWXMLæ¨¡æ¿ -->
<!-- è¿™ä¸ªæ–‡ä»¶å±•ç¤ºäº†å¦‚ä½•åœ¨ç°æœ‰æ¨¡æ¿ä¸­é›†æˆGoogleMapsApiçš„æœç´¢å’Œé™„è¿‘æ™¯ç‚¹åŠŸèƒ½ -->
<view class="add-spot-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-title">
    <text class="title-text">æ·»åŠ æ–°æ™¯ç‚¹</text>
    <text class="subtitle-text">åˆ†äº«æ‚¨å‘ç°çš„ç¾å¥½åœ°æ–¹</text>
  </view>
  <!-- è¡¨å•å†…å®¹ -->
  <form bindsubmit="onSubmit" class="spot-form">
    <!-- åŸºæœ¬ä¿¡æ¯åŒºåŸŸ -->
    <view class="form-section">
      <view class="section-title">
        <text class="title-icon">ğŸ“</text>
        <text>åŸºæœ¬ä¿¡æ¯</text>
      </view>
      <!-- æ™¯ç‚¹åç§° -->
      <view class="form-item">
        <text class="label">æ™¯ç‚¹åç§° *</text>
        <input class="input" placeholder="è¯·è¾“å…¥æ™¯ç‚¹åç§°" value="{{formData.name}}" bindinput="onNameInput" />
      </view>
      <!-- æ™¯ç‚¹æè¿° -->
      <view class="form-item">
        <text class="label">æ™¯ç‚¹æè¿°</text>
        <textarea class="textarea" placeholder="è¯·æè¿°è¿™ä¸ªæ™¯ç‚¹çš„ç‰¹è‰²å’Œäº®ç‚¹" value="{{formData.description}}" bindinput="onDescriptionInput" maxlength="500" />
        <text class="char-count">{{formData.description.length}}/500</text>
      </view>
      <!-- æ™¯ç‚¹åˆ†ç±» -->
      <view class="form-item">
        <text class="label">æ™¯ç‚¹åˆ†ç±» *</text>
        <picker range="{{categories}}" value="{{selectedCategoryIndex}}" bindchange="onCategoryChange" class="picker">
          <view class="picker-display">
            {{formData.category || 'è¯·é€‰æ‹©åˆ†ç±»'}}
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>
    </view>
    <!-- ä½ç½®ä¿¡æ¯åŒºåŸŸ - å¢å¼ºç‰ˆ -->
    <view class="form-section">
      <view class="section-title">
        <text class="title-icon">ğŸ“</text>
        <text>ä½ç½®ä¿¡æ¯</text>
        <view class="title-actions">
          <button class="mini-btn" type="default" bindtap="clearLocation" wx:if="{{formData.latitude}}">
            æ¸…é™¤
          </button>
        </view>
      </view>
      <!-- åœ°å€è¾“å…¥å’Œæœç´¢ -->
      <view class="form-item">
        <text class="label">æ™¯ç‚¹åœ°å€</text>
        <view class="address-search-container">
          <input class="input address-input" placeholder="è¯·è¾“å…¥åœ°å€æˆ–ç‚¹å‡»åœ°å›¾é€‰æ‹©ä½ç½®" value="{{formData.address}}" bindinput="onAddressInput" />
          <!-- æœç´¢çŠ¶æ€æŒ‡ç¤ºå™¨ -->
          <view class="search-indicator" wx:if="{{isSearching}}">
            <text class="loading-text">æœç´¢ä¸­...</text>
          </view>
          <!-- æœç´¢å»ºè®®åˆ—è¡¨ -->
          <view class="suggestions-list" wx:if="{{searchSuggestions.length > 0}}">
            <view class="suggestion-item" wx:for="{{searchSuggestions}}" wx:key="place_id" data-suggestion="{{item}}" bindtap="selectSuggestion">
              <text class="suggestion-main">{{item.terms[0].value}}</text>
              <text class="suggestion-detail">{{item.description}}</text>
            </view>
          </view>
        </view>
      </view>
      <!-- åæ ‡æ˜¾ç¤º -->
      <view class="coordinates-display" wx:if="{{formData.latitude}}">
        <text class="coordinates-label">åæ ‡ä¿¡æ¯:</text>
        <text class="coordinates-text">
          {{formData.latitude.toFixed(6)}}, {{formData.longitude.toFixed(6)}}
        </text>
      </view>
      <!-- åœ°å›¾ç»„ä»¶ -->
      <view class="map-container">
        <map id="locationMap" class="location-map" latitude="{{selectedLocation.latitude || 39.9042}}" longitude="{{selectedLocation.longitude || 116.4074}}" scale="15" markers="{{mapMarkers}}" bindtap="onMapTap" show-location="true">
          <!-- åœ°å›¾ä¸­å¿ƒæ ‡è®° -->
          <view class="map-center-marker" wx:if="{{!selectedLocation}}">
            <text class="center-icon">ğŸ“</text>
          </view>
        </map>
        <!-- åœ°å›¾æç¤ºæ–‡å­— -->
        <view class="map-hint">
          <text class="hint-text">ç‚¹å‡»åœ°å›¾é€‰æ‹©ç²¾ç¡®ä½ç½®</text>
        </view>
      </view>
      <!-- é™„è¿‘æ™¯ç‚¹ä¿¡æ¯ -->
      <view class="nearby-section" wx:if="{{nearbyAttractions.length > 0}}">
        <view class="nearby-header" bindtap="toggleNearbyList">
          <text class="nearby-title">é™„è¿‘æ™¯ç‚¹ ({{nearbyAttractions.length}}ä¸ª)</text>
          <text class="toggle-icon">{{showNearbyList ? 'â–²' : 'â–¼'}}</text>
        </view>
        <view class="nearby-list" wx:if="{{showNearbyList}}">
          <view class="nearby-item" wx:for="{{nearbyAttractions}}" wx:key="placeId" data-attraction="{{item}}" bindtap="viewNearbyAttraction">
            <view class="nearby-info">
              <text class="nearby-name">{{item.name}}</text>
              <text class="nearby-distance">{{item.formattedDistance}}</text>
            </view>
            <text class="nearby-arrow">â†’</text>
          </view>
        </view>
      </view>
    </view>
    <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
    <view class="form-section">
      <view class="section-title">
        <text class="title-icon">ğŸ“·</text>
        <text>æ™¯ç‚¹å›¾ç‰‡</text>
      </view>
      <view class="image-upload-container">
        <!-- å·²ä¸Šä¼ çš„å›¾ç‰‡ -->
        <view class="uploaded-images" wx:if="{{formData.images.length > 0}}">
          <view class="image-item" wx:for="{{formData.images}}" wx:key="index">
            <image class="uploaded-image" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-index="{{index}}" />
            <view class="image-delete" data-index="{{index}}" bindtap="deleteImage">
              <text class="delete-icon">Ã—</text>
            </view>
          </view>
        </view>
        <!-- æ·»åŠ å›¾ç‰‡æŒ‰é’® -->
        <view class="add-image-btn" bindtap="chooseImage" wx:if="{{formData.images.length < 9}}">
          <text class="add-icon">+</text>
          <text class="add-text">æ·»åŠ å›¾ç‰‡</text>
        </view>
        <!-- å›¾ç‰‡æç¤º -->
        <view class="image-hint">
          <text class="hint-text">æœ€å¤šå¯ä¸Šä¼ 9å¼ å›¾ç‰‡ï¼Œå»ºè®®ä¸Šä¼ é«˜è´¨é‡çš„æ™¯ç‚¹ç…§ç‰‡</text>
        </view>
      </view>
    </view>
    <!-- é¢å¤–ä¿¡æ¯åŒºåŸŸ -->
    <view class="form-section">
      <view class="section-title">
        <text class="title-icon">â„¹ï¸</text>
        <text>è¯¦ç»†ä¿¡æ¯</text>
      </view>
      <!-- å¼€æ”¾æ—¶é—´ -->
      <view class="form-item">
        <text class="label">å¼€æ”¾æ—¶é—´</text>
        <input class="input" placeholder="ä¾‹å¦‚ï¼š09:00-18:00" value="{{formData.openingHours}}" bindinput="onOpeningHoursInput" />
      </view>
      <!-- é—¨ç¥¨ä»·æ ¼ -->
      <view class="form-item">
        <text class="label">é—¨ç¥¨ä»·æ ¼</text>
        <input class="input" placeholder="ä¾‹å¦‚ï¼šå…è´¹ã€50å…ƒã€å­¦ç”Ÿç¥¨30å…ƒ" value="{{formData.ticketPrice}}" bindinput="onTicketPriceInput" />
      </view>
      <!-- è”ç³»æ–¹å¼ -->
      <view class="form-item">
        <text class="label">è”ç³»æ–¹å¼</text>
        <input class="input" placeholder="ç”µè¯å·ç æˆ–å®˜æ–¹ç½‘ç«™" value="{{formData.contact}}" bindinput="onContactInput" />
      </view>
      <!-- æ ‡ç­¾ -->
      <view class="form-item">
        <text class="label">æ™¯ç‚¹æ ‡ç­¾</text>
        <view class="tags-container">
          <view class="tag-item {{item.selected ? 'selected' : ''}}" wx:for="{{availableTags}}" wx:key="name" data-tag="{{item}}" bindtap="toggleTag">
            <text class="tag-text">{{item.name}}</text>
          </view>
        </view>
      </view>
      <!-- è®¾æ–½æœåŠ¡ -->
      <view class="form-item">
        <text class="label">è®¾æ–½æœåŠ¡</text>
        <view class="facilities-container">
          <view class="facility-item {{item.selected ? 'selected' : ''}}" wx:for="{{availableFacilities}}" wx:key="name" data-facility="{{item}}" bindtap="toggleFacility">
            <text class="facility-icon">{{item.icon}}</text>
            <text class="facility-text">{{item.name}}</text>
          </view>
        </view>
      </view>
    </view>
    <!-- æäº¤æŒ‰é’®åŒºåŸŸ -->
    <view class="submit-section">
      <button class="submit-btn" form-type="submit" type="primary">
        <text class="submit-text">æäº¤æ™¯ç‚¹ä¿¡æ¯</text>
      </button>
      <view class="submit-hint">
        <text class="hint-text">æäº¤åå°†è¿›å…¥å®¡æ ¸æµç¨‹ï¼Œå®¡æ ¸é€šè¿‡åå³å¯åœ¨åœ°å›¾ä¸Šæ˜¾ç¤º</text>
      </view>
    </view>
  </form>
</view>
<!-- åŠ è½½æç¤º -->
<view class="loading-overlay" wx:if="{{loading}}">
  <view class="loading-content">
    <text class="loading-text">{{loadingText}}</text>
  </view>
</view>