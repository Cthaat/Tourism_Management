<!-- filepath: c:\Code\Tourism_Management\pages\detail\detail.wxml -->
<!-- ================================================================
 * æ–‡ä»¶å: detail.wxml
 * æè¿°: æ—…æ¸¸ç®¡ç†å¾®ä¿¡å°ç¨‹åºçš„æ™¯ç‚¹è¯¦æƒ…é¡µé¢ç»“æ„æ–‡ä»¶
 * ç‰ˆæœ¬: 1.0.0
 * åˆ›å»ºæ—¥æœŸ: 2025-05-13
 * ä½œè€…: Tourism_Managementå¼€å‘å›¢é˜Ÿ
 * 
 * åŠŸèƒ½è¯´æ˜:
 * - å±•ç¤ºå•ä¸ªæ—…æ¸¸æ™¯ç‚¹çš„è¯¦ç»†ä¿¡æ¯
 * - æä¾›å›¾ç‰‡è½®æ’­å’Œæµè§ˆåŠŸèƒ½
 * - åŒ…å«æ”¶è—å’Œé¢„è®¢äº¤äº’ç»„ä»¶
 * - æ˜¾ç¤ºæ™¯ç‚¹è¯„åˆ†ã€ä»·æ ¼å’Œç‰¹è‰²ä¿¡æ¯
 * - æ”¯æŒå¤šä¸»é¢˜è‰²å’Œæ·±è‰²æ¨¡å¼
 * ================================================================ -->
<!-- é¡µé¢å®¹å™¨: æ ¹æ®ä¸»é¢˜è®¾ç½®æ ·å¼ -->
<view class="container {{isDarkMode ? 'dark-mode' : ''}}" data-theme="{{colorTheme}}">
		<block wx:if="{{spot}}">
				<!-- é¡¶éƒ¨å›¾ç‰‡å±•ç¤ºåŒº: åŒ…å«è½®æ’­å›¾å’Œè¿”å›æŒ‰é’® -->
				<view class="image-gallery">
						<!-- è¿”å›æŒ‰é’®: ç‚¹å‡»è¿”å›ä¸Šä¸€é¡µ -->
						<view class="back-button" bindtap="goBack">
								<text class="back-icon">â†</text>
						</view>
						<!-- å›¾ç‰‡è½®æ’­: è‡ªåŠ¨æ’­æ”¾æ™¯ç‚¹å›¾ç‰‡ -->
						<swiper class="gallery-swiper" indicator-dots="true" autoplay="{{spot.images && spot.images.length > 1}}" interval="3000" duration="500" circular="{{spot.images && spot.images.length > 1}}">
								<!-- å¦‚æœæœ‰å›¾ç‰‡æ•°ç»„ï¼Œå¾ªç¯æ˜¾ç¤ºæ‰€æœ‰å›¾ç‰‡ -->
								<swiper-item wx:for="{{spot.images}}" wx:key="index" wx:if="{{spot.images && spot.images.length > 0}}">
										<image class="gallery-image" src="{{item}}" mode="aspectFill" />
								</swiper-item>
								<!-- å¦‚æœæ²¡æœ‰å›¾ç‰‡æ•°ç»„ï¼Œä½¿ç”¨ä¸»å›¾æˆ–é»˜è®¤å›¾ç‰‡ -->
								<swiper-item wx:if="{{!spot.images || spot.images.length === 0}}">
										<image class="gallery-image" src="{{spot.mainImage || spot.image || '/images/default-spot.png'}}" mode="aspectFill" />
								</swiper-item>
						</swiper>
						<!-- å›¾ç‰‡ç”»å»Šè¦†ç›–å±‚: æä¾›æŸ¥çœ‹æ‰€æœ‰å›¾ç‰‡çš„å…¥å£ -->
						<view class="gallery-overlay">
								<view class="gallery-button">
										<text class="gallery-button-text">æ‰€æœ‰å›¾åƒ</text>
								</view>
						</view>
				</view>
				<!-- æ™¯ç‚¹ä¸»è¦ä¿¡æ¯åŒºåŸŸ: å±•ç¤ºæ™¯ç‚¹åŸºæœ¬ä¿¡æ¯ -->
				<view class="spot-main-info {{isDarkMode ? 'dark-mode' : ''}}">
						<!-- æ ‡é¢˜åŒºåŸŸ: åŒ…å«åç§°ã€è¯„åˆ†å’Œåˆ†ç±» -->
						<view class="spot-title-section">
								<view class="spot-name">{{spot.name}}</view>
								<!-- è¯„åˆ†åŒºåŸŸ: å±•ç¤ºæ˜Ÿçº§è¯„åˆ†å’Œè¯„è®ºæ•°é‡ -->
								<view class="rating-section">
										<view class="rating-icon">â­</view>
										<view class="rating-value">{{spot.rating}}/5</view>
										<view class="rating-count">({{spot.reviewCount || '1.4ä¸‡'}})</view>
								</view>
								<view class="spot-category">
										<text class="category-icon">{{spot.categoryIcon}}</text>
										{{spot.location}} ä¸­çš„ {{spot.category}}
								</view>
						</view>
						<!-- æ“ä½œæŒ‰é’® -->
						<view class="action-panel">
								<button class="main-action-btn" bindtap="getDirections">
										<view class="btn-inner">
												<text class="action-icon">ğŸ—ºï¸</text>
												<text class="action-text">è·¯çº¿</text>
										</view>
								</button>
								<view class="action-buttons">
										<button class="action-item" bindtap="openWikipedia">
												<text class="action-text">Wikipedia</text>
										</button>
										<button class="action-item ticket-btn" bindtap="buyTicket">
												<text class="action-text">ç¥¨</text>
										</button>
								</view>
						</view>
						<!-- ä½ç½®ä¿¡æ¯ -->
						<view class="info-section">
								<view class="info-row" bindtap="copyAddress">
										<text class="info-icon">ğŸ“</text>
										<text class="info-text">
												{{spot.address || (spot.location + 'æ™¯åŒº')}}
										</text>
								</view>
								<view class="info-row" bindtap="callPhone">
										<text class="info-icon">ğŸ“</text>
										<text class="info-text">{{spot.phone || '400 123 4567'}}</text>
								</view>
								<view class="info-row">
										<text class="info-icon">ğŸ•’</text>
										<text class="info-text">è¥ä¸šæ—¶é—´: {{spot.hours || 'æš‚æœªæä¾›'}}</text>
										<text class="hours-expand">â–¼</text>
								</view>
								<view class="info-row" wx:if="{{spot.bestSeasonText}}">
										<text class="info-icon">ğŸŒ¸</text>
										<text class="info-text">æœ€ä½³å­£èŠ‚: {{spot.bestSeasonText}}</text>
								</view>
								<view class="info-row" wx:if="{{spot.website}}" bindtap="openWebsite">
										<text class="info-icon">ğŸŒ</text>
										<text class="info-text">å®˜æ–¹ç½‘ç«™</text>
								</view>
						</view>
						<!-- ç»´æŠ¤ä¿¡æ¯ -->
						<view class="maintenance-info">
								<text class="maintenance-text">ç½‘ç«™ç»´æŠ¤ï¼š{{spot.name}}æ•°å­—ä¸ä¿¡æ¯éƒ¨</text>
								<text class="check-more">æŸ¥çœ‹æ›´å¤šå†…å®¹</text>
						</view>
						<!-- è¯„è®ºåŒºåŸŸ -->
						<view class="comments-section {{isDarkMode ? 'dark-mode' : ''}}" wx:if="{{commentsLoaded}}">
								<!-- è¯„è®ºç»Ÿè®¡å¤´éƒ¨ -->
								<view class="comments-header">
										<view class="comments-title">
												<text class="comments-count">{{commentStats.total}}æ¡è¯„è®º</text>
												<view class="average-rating">
														<text class="rating-score">{{commentStats.averageRating}}</text>
														<view class="rating-stars">
																<block wx:for="{{5}}" wx:key="index">
																		<text class="star {{index < Math.floor(commentStats.averageRating) ? 'filled' : ''}}">
																				â­
																		</text>
																</block>
														</view>
												</view>
										</view>
										<button class="write-comment-btn {{isDarkMode ? 'dark-mode' : ''}}" bindtap="writeComment">
												<text class="write-icon">âœï¸</text>
												<text>å†™è¯„è®º</text>
										</button>
								</view>
								<!-- è¯„åˆ†åˆ†å¸ƒ -->
								<view class="rating-distribution">
										<block wx:for="{{5}}" wx:key="index">
												<view class="rating-bar">
														<text class="rating-label">{{5-index}}æ˜Ÿ</text>
														<view class="bar-container">
																<view class="bar-fill" style="width: {{(commentStats.ratingDistribution[4-index] / commentStats.total * 100) || 0}}%" />
														</view>
														<text class="rating-count">
																{{commentStats.ratingDistribution[4-index] || 0}}
														</text>
												</view>
										</block>
								</view>
								<!-- è¯„è®ºåˆ—è¡¨ -->
								<view class="comments-list">
										<block wx:for="{{showAllComments ? comments : comments.slice(0, displayCommentCount)}}" wx:key="id">
												<comment-card comment="{{item}}" isDarkMode="{{isDarkMode}}" colorTheme="{{colorTheme}}" bind:like="handleLike" bind:reply="handleReply" bind:viewProfile="viewProfile" />
										</block>
								</view>
								<!-- æŸ¥çœ‹æ›´å¤šè¯„è®ºæŒ‰é’® -->
								<view wx:if="{{!showAllComments && comments.length > displayCommentCount}}" class="show-more-comments">
										<button class="show-more-btn {{isDarkMode ? 'dark-mode' : ''}}" bindtap="toggleShowAllComments">
												æŸ¥çœ‹å…¨éƒ¨{{comments.length}}æ¡è¯„è®º
										</button>
								</view>
						</view>
				</view>
		</block>
		<!-- åº•éƒ¨æ“ä½œåŒº -->
		<view class="bottom-actions {{isDarkMode ? 'dark-mode' : ''}}">
				<button class="action-btn btn-favorite {{isFavorite ? 'active' : ''}} {{isDarkMode ? 'dark-mode' : ''}}" hover-class="btn-hover" bindtap="toggleFavorite">
						<view class="btn-content">
								<text class="btn-icon {{isDarkMode ? 'dark-mode' : ''}}">
										{{isFavorite ? 'â¤ï¸' : 'â™¡'}}
								</text>
								<text>{{isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
						</view>
				</button>
				<button class="action-btn btn-primary {{isDarkMode ? 'dark-mode' : ''}}" hover-class="btn-hover" bindtap="makeReservation">
						<view class="btn-content">
								<text class="btn-icon {{isDarkMode ? 'dark-mode' : ''}}">ğŸ«</text>
								<text>ç«‹å³é¢„è®¢</text>
						</view>
				</button>
		</view>
</view>