<!-- pages/travel-plan/travel-plan.wxml -->
<view class="container {{isDarkMode ? 'dark-mode' : ''}}">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="header-content">
      <view class="title">æˆ‘çš„æ—…è¡Œè®¡åˆ’</view>
      <view class="subtitle">è§„åˆ’æ‚¨çš„å®Œç¾æ—…ç¨‹</view>
    </view>
    <view class="header-actions">
      <button class="action-btn" bindtap="onCreatePlan">
        <text class="icon">+</text>
        <text>æ–°å»ºè®¡åˆ’</text>
      </button>
    </view>
  </view>
  <!-- è®¡åˆ’åˆ—è¡¨ -->
  <view class="plans-section" wx:if="{{planList.length > 0}}">
    <view class="section-title">
      <text class="title-text">æˆ‘çš„è®¡åˆ’</text>
      <text class="count">({{planList.length}}ä¸ª)</text>
    </view>
    <scroll-view scroll-y class="plans-list">
      <view class="plan-item" wx:for="{{planList}}" wx:key="id" bindtap="onViewPlan" data-plan="{{item}}">
        <view class="plan-header">
          <view class="plan-title">{{item.title}}</view>
          <view class="plan-status status-{{item.status}}">
            {{item.statusText}}
          </view>
        </view>
        <view class="plan-info">
          <view class="info-item">
            <text class="icon">ğŸ“…</text>
            <text class="text">{{item.startDate}} - {{item.endDate}}</text>
          </view>
          <view class="info-item">
            <text class="icon">ğŸ“</text>
            <text class="text">{{item.destination}}</text>
          </view>
          <view class="info-item">
            <text class="icon">ğŸ¯</text>
            <text class="text">{{item.spotCount}}ä¸ªæ™¯ç‚¹</text>
          </view>
          <view class="info-item" wx:if="{{item.budget > 0}}">
            <text class="icon">ğŸ’°</text>
            <text class="text">é¢„ç®—: Â¥{{item.budget}}</text>
          </view>
        </view>
        <view class="plan-progress" wx:if="{{item.status === 'ongoing'}}">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{item.progress}}%"></view>
          </view>
          <text class="progress-text">{{item.progress}}% å·²å®Œæˆ</text>
        </view>
        <view class="plan-actions">
          <button class="action-btn-small" bindtap="onEditPlan" data-plan="{{item}}" data-action="edit">
            <text class="icon">âœï¸</text>
            <text>ç¼–è¾‘</text>
          </button>
          <button class="action-btn-small" bindtap="onSharePlan" data-plan="{{item}}" data-action="share">
            <text class="icon">ğŸ“¤</text>
            <text>åˆ†äº«</text>
          </button>
          <button class="action-btn-small danger" bindtap="onDeletePlan" data-plan="{{item}}" data-action="delete">
            <text class="icon">ğŸ—‘ï¸</text>
            <text>åˆ é™¤</text>
          </button>
        </view>
      </view>
    </scroll-view>
  </view>
  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{planList.length === 0 && !isLoading}}">
    <view class="empty-icon">âœˆï¸</view>
    <view class="empty-title">è¿˜æ²¡æœ‰æ—…è¡Œè®¡åˆ’</view>
    <view class="empty-subtitle">åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªæ—…è¡Œè®¡åˆ’ï¼Œå¼€å§‹ç²¾å½©æ—…ç¨‹</view>
    <button class="empty-action-btn" bindtap="onCreatePlan">ç«‹å³åˆ›å»º</button>
  </view>
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
  <!-- å¿«é€Ÿæ¨è -->
  <view class="recommendations" wx:if="{{recommendedDestinations.length > 0}}">
    <view class="section-title">
      <text class="title-text">çƒ­é—¨ç›®çš„åœ°</text>
      <text class="subtitle-text">ä¸ºæ‚¨æ¨è</text>
    </view>
    <scroll-view scroll-x class="recommendations-scroll">
      <view class="recommendation-item" wx:for="{{recommendedDestinations}}" wx:key="id" bindtap="onSelectDestination" data-destination="{{item}}">
        <image class="recommendation-image" src="{{item.image}}" mode="aspectFill"></image>
        <view class="recommendation-info">
          <view class="recommendation-name">{{item.name}}</view>
          <view class="recommendation-desc">{{item.description}}</view>
          <view class="recommendation-price">Â¥{{item.avgBudget}}/äºº</view>
        </view>
      </view>
    </scroll-view>
  </view>
  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="fab" bindtap="onCreatePlan">
    <text class="fab-icon">+</text>
  </view>
</view>
<!-- åˆ›å»ºè®¡åˆ’å¼¹çª— -->
<view class="modal {{showCreateModal ? 'show' : ''}}" wx:if="{{showCreateModal}}">
  <view class="modal-mask" bindtap="onCloseCreateModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">åˆ›å»ºæ—…è¡Œè®¡åˆ’</text>
      <button class="modal-close" bindtap="onCloseCreateModal">âœ•</button>
    </view>
    <view class="modal-body">
      <view class="form-group">
        <label class="form-label">è®¡åˆ’åç§°</label>
        <input class="form-input" placeholder="ä¸ºæ‚¨çš„æ—…è¡Œèµ·ä¸ªåå­—" value="{{newPlan.title}}" bindinput="onTitleInput" />
      </view>
      <view class="form-group">
        <label class="form-label">ç›®çš„åœ°</label>
        <input class="form-input" placeholder="æƒ³å»å“ªé‡Œç©å‘¢ï¼Ÿ" value="{{newPlan.destination}}" bindinput="onDestinationInput" />
      </view>
      <view class="form-row">
        <view class="form-group half">
          <label class="form-label">å¼€å§‹æ—¥æœŸ</label>
          <picker mode="date" value="{{newPlan.startDate}}" bindchange="onStartDateChange">
            <view class="picker-input">{{newPlan.startDate || 'é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>
        <view class="form-group half">
          <label class="form-label">ç»“æŸæ—¥æœŸ</label>
          <picker mode="date" value="{{newPlan.endDate}}" bindchange="onEndDateChange">
            <view class="picker-input">{{newPlan.endDate || 'é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
        </view>
      </view>
      <view class="form-group">
        <label class="form-label">é¢„ç®— (å¯é€‰)</label>
        <input class="form-input" type="number" placeholder="é¢„è®¡èŠ±è´¹" value="{{newPlan.budget}}" bindinput="onBudgetInput" />
      </view>
      <view class="form-group">
        <label class="form-label">å¤‡æ³¨ (å¯é€‰)</label>
        <textarea class="form-textarea" placeholder="æ·»åŠ ä¸€äº›å¤‡æ³¨..." value="{{newPlan.notes}}" bindinput="onNotesInput"></textarea>
      </view>
    </view>
    <view class="modal-footer">
      <button class="btn-cancel" bindtap="onCloseCreateModal">å–æ¶ˆ</button>
      <button class="btn-confirm" bindtap="onConfirmCreate" disabled="{{!canCreate}}">
        åˆ›å»º
      </button>
    </view>
  </view>
</view>